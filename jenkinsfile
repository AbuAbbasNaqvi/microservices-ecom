pipeline {
  agent any
  
  environment {
    DOCKER_REGISTRY = 'docker.io'
    DOCKER_ORG = 'abbasnaqvi'  // Your Docker Hub organization/username
    REGISTRY_CREDS_ID = 'dockerhub-creds'  // Jenkins credentials ID
    SERVICES = 'cart,payment,request'
    NOTIFICATION_EMAILS = 'your.email@example.com'  // Add your email
  }

  parameters {
    string(name: 'build_version', defaultValue: 'V1.0', description: 'Build version')
  }

  stages {
    stage('Checkout') {
      steps {
        checkout scm
      }
    }

    stage('Build & Push') {
      steps {
        script {
          buildStage()
        }
      }
    }

    stage('Deploy') {
      steps {
        script {
          deployStage()
        }
      }
    }
  }

  post {
    always {
      script {
        notifyStage(currentBuild.result)
      }
    }
  }
}
